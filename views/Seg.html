<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paciente-Principal</title>
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paciente-Principal</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background-color: #F2E6CF;
    font-family: "Sora", sans-serif;
}

header {
    background-color: #114c5f;
    margin: 10px;
    border-radius: 20px;
}

.head {
    display: flex;
    align-items: center;
    padding: 20px;
    flex-wrap: wrap;
    justify-content: space-between;
}

.head img {
    width: 80px;
    height: auto;
    margin-left: 20px;
}
.head h1 {
    color: white;
    font-size: 25px;
    margin: 0 20px;
    transition: color 0.3s ease;
}
.head h2 {
    color: white;
    font-size: 20px;
    margin: 0 20px;
    transition: color 0.3s ease;
}
.head h2:hover {
    color: #91CBD6;
}
.head button {
    padding: 10px 20px;
    border-radius: 10px;
    background-color: #9Cd2d3;
    color: #114c5f;
    border: none;
    cursor: pointer;
}
.head button h3 {
    font-size: 18px;
}
.head button:hover {
    color: red;
}

.tex {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
}
a {
    text-decoration: none;
}

.bs {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    gap: 30px;
    padding: 20px;
}

.tab1, .tab2 {
    flex: 1 1 450px;
    max-width: 100%;
    text-align: center;
}

h3 {
    color: #114c5f;
    font-size: 24px;
    margin: 10px 0;
}

.table-container {
    overflow-x: auto;
    max-width: 100%;
}

table {
    border-collapse: collapse;
    width: 100%;
    background-color: white;
    border-radius: 10px;
    overflow: hidden;
    min-width: 700px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

thead {
    background-color: #a3cdd1;
    color: #1b2b33;
}

thead th, tbody td {
    padding: 10px;
    font-size: 14px;
    text-align: center;
    border-top: 1px solid #ddd;
    word-break: break-word;
}

button {
    border: none;
    background-color: #114c5f;
    color: white;
    width: 20%;
    height: 40px;
    margin: 20px auto;
    border-radius: 20px;
    cursor: pointer;
}

.exp {
    width: 250px;
    text-align: center;
    height: 50px;
    background-color: #114c5f;
    border-radius: 20px;
    color: white;
    line-height: 50px;
    margin: 20px auto;
    display: inline-block;
}

.salir {
    width: 200px;
    height: 50px;
    margin: 20px auto;
    background-color: #114c5f;
    border-radius: 20px;
    color: white;
    text-align: center;
    line-height: 50px;
}

.salir:hover {
    background-color: #9cd2d3;
}

.ps {
    width: 100%;
    text-align: center;
    margin: 20px;
}

.selected {
    background-color: #d1f7d1 !important;
}

@media screen and (max-width: 900px) {
    .head {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    .tex {
        flex-direction: column;
        align-items: center;
    }
    table {
        min-width: 100%;
    }
}
    </style>
</head>
<body>
    <header>
        <div class="head">
            <div class="Ima">
                <img src="img/Solo-Logo.png" alt="">
            </div>
            <div class="tex">
              <h1>Bienvenido Doctor</h1>
              <a href="Paciente.html"><h2 class="hov">Pagina-Principal</h2></a>
              <a href="Cita.html"><h2>Pedir una cita</h2></a>
              <h2 class="un">Seguimiento</h2>
            </div>
         <button id="logoutBtn"><h3>Cerrar sesión</h3></button>
        </div>
    </header>
    <div class="ps">
    <h3>Seguimiento de los Tratamientos</h3>
</div>
    <div class="bs">
        <div class="tab1">
            <div>
            <h3>Tratamientos en Progreso</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            
                            <th>Nombre del medicamento</th>
                            <th>Forma farmaceutica</th>
                            <th>Concentración</th>
                            <th>Dosis</th>
                            <th>Via de administración</th>
                            <th>Frecuencia</th>
                            <th>Dias de aplicación</th>
                            <th>Marcar como completado</th>
                        </tr>
                    </thead>
                    </div>
                    <div>
                    <tbody id="tabla-progreso"></tbody> <!-- Tratamientos en progreso -->
                        <!-- Las citas se llenarán dinámicamente -->
                    </tbody>
                </table>
                
            </div>
        </div>
        <div class="tab2">
            <h3>Tratamientos Completados</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            
                            <th>Nombre del medicamento</th>
                            <th>Forma farmaceutica</th>
                            <th>Concentración</th>
                            <th>Dosis</th>
                            <th>Via de administración</th>
                            <th>Frecuencia</th>
                            <th>Dias de aplicación</th>
                             <th>Marcar como incompleto</th>
                        </tr>
                    </thead>
                    <tbody id="tabla-completados"></tbody> <!-- Tratamientos completados -->
                        <!-- Las citas se llenarán dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>

</div>
<div class="bs2">
    
   
</div>
 <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import {
  getAuth,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
import {
  getFirestore,
  collection,
  getDocs,
  query,
  where,
  updateDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAofOyGzsSWHQG3FfsFrGbVWjW0xMywb9c",
  authDomain: "doctrack-46fc2.firebaseapp.com",
  projectId: "doctrack-46fc2",
  storageBucket: "doctrack-46fc2.appspot.com",
  messagingSenderId: "865552814891",
  appId: "1:865552814891:web:cf8e79d5ffd847067bab6e",
  measurementId: "G-XQPNKXK08Y"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Logout
document.getElementById("logoutBtn").addEventListener("click", async () => {
  try {
    await signOut(auth);
    window.location.href = "index.html";
  } catch (err) {
    console.error("Error al cerrar sesión", err);
  }
});

const tablaProgreso = document.getElementById("tabla-progreso");
const tablaCompletados = document.getElementById("tabla-completados");

let usuarioId = null;

onAuthStateChanged(auth, async (user) => {
  if (!user) return window.location.href = "index.html";
  usuarioId = user.uid;
  await cargarTratamientos();
});

async function cargarTratamientos() {
  const snap = await getDocs(query(
    collection(db, "tratamientos"),
    where("paciente", "==", usuarioId)
  ));
  const tratamientos = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));

  renderTablas(tratamientos);
}

function renderTablas(tratamientos) {
  tablaProgreso.innerHTML = "";
  tablaCompletados.innerHTML = "";

  tratamientos.forEach(t => {
    const fila = document.createElement("tr");
    fila.innerHTML = `
      <td>${t.medicamento}</td>
      <td>${t.forma}</td>
      <td>${t.concentracion}</td>
      <td>${t.dosis}</td>
      <td>${t.via}</td>
      <td>${t.frecuencia}</td>
      <td>${t.dias}</td>
    `;

    const btnTd = document.createElement("td");
    const btn = document.createElement("button");

    if (t.completado) {
      btn.textContent = "🔴";
      btn.title = "Marcar como incompleto";
      btn.style.backgroundColor = "#ffc107"; // amarillo
      btn.addEventListener("click", async () => {
        await updateDoc(doc(db, "tratamientos", t.id), {
          completado: false
        });
        await cargarTratamientos();
      });
      btnTd.appendChild(btn);
      fila.appendChild(btnTd);
      tablaCompletados.appendChild(fila);
    } else {
      btn.textContent = "🟢";
      btn.title = "Marcar como completado";
      btn.style.backgroundColor = "#28a745"; // verde
      btn.addEventListener("click", async () => {
        await updateDoc(doc(db, "tratamientos", t.id), {
          completado: true
        });
        await cargarTratamientos();
      });
      btnTd.appendChild(btn);
      fila.appendChild(btnTd);
      tablaProgreso.appendChild(fila);
    }

    btn.style.color = "white";
    btn.style.borderRadius = "10px";
    btn.style.cursor = "pointer";
    btn.style.padding = "5px 10px";
  });
}



</script>
       
</body>
</html>