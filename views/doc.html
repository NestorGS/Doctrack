<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocTrack</title>
    <link rel="stylesheet" href="css/doc.css">
</head>
<body>
        <header><img src="img/Captura_de_pantalla_2024-10-15_010848-removebg-preview.png" alt=""></header>

    <div class="container">
        <h2>Bienvenidos A DocTrack</h2>
        <div class="bs">
        <div class="formu">
        <button class="info-button" onclick="toggleForm()">Información Personal</button>
        
        <div class="form-container" id="formPersonal">
            <input id="nombre" type="text" placeholder="Nombre(s)">
            <input id="paterno" type="text" placeholder="Apellido Paterno">
            <input id="materno" type="text" placeholder="Apellido Materno">
            <input id="correo" type="email" placeholder="Correo electronico">
            <input id="cedula" type="text" placeholder="Cedula o Matricula">
            <select id="especialidad" name="especialidad" class="esp">
                <option value="ninguna">Ninguna</option>
                <option value="medicina_interna">Medicina Interna</option>
                <option value="pediatria">Pediatría</option>
                <option value="ginecologia_obstetricia">Ginecología y Obstetricia</option>
                <option value="cardiologia">Cardiología</option>
                <option value="neurologia">Neurología</option>
                <option value="dermatologia">Dermatología</option>
                <option value="oftalmologia">Oftalmología</option>
                <option value="otorrinolaringologia">Otorrinolaringología</option>
                <option value="psiquiatria">Psiquiatría</option>
                <option value="geriatria">Geriatría</option>
                <option value="cirugia_general">Cirugía General</option>
                <option value="neurocirugia">Neurocirugía</option>
                <option value="cirugia_cardiovascular">Cirugía Cardiovascular</option>
                <option value="cirugia_toracica">Cirugía Torácica</option>
                <option value="cirugia_plastica_reconstructiva">Cirugía Plástica y Reconstructiva</option>
                <option value="cirugia_ortopedica">Cirugía Ortopédica</option>
                <option value="cirugia_pediatrica">Cirugía Pediátrica</option>
                <option value="cirugia_oncologica">Cirugía Oncológica</option>
                <option value="endocrinologia">Endocrinología</option>
                <option value="nefrologia">Nefrología</option>
                <option value="gastroenterologia">Gastroenterología</option>
                <option value="hematologia">Hematología</option>
                <option value="infectologia">Infectología</option>
                <option value="oncologia">Oncología</option>
                <option value="alergologia_inmunologia">Alergología e Inmunología</option>
                <option value="reumatologia">Reumatología</option>
                <option value="neumologia">Neumología</option>
                <option value="medicina_fisica_rehabilitacion">Medicina Física y Rehabilitación</option>
                <option value="medicina_familiar">Medicina Familiar</option>
                <option value="medicina_preventiva">Medicina Preventiva</option>
                <option value="medicina_del_deporte">Medicina del Deporte</option>
                <option value="medicina_del_trabajo">Medicina del Trabajo</option>
                <option value="cuidados_paliativos">Cuidados Paliativos</option>
                <option value="genetica_medica">Genética Médica</option>
                <option value="medicina_urgencias">Medicina de Urgencias</option>
                <option value="anestesiologia">Anestesiología</option>
                <option value="radiologia">Radiología</option>
                <option value="patologia">Patología</option>
                <option value="medicina_nuclear">Medicina Nuclear</option>
                <option value="psicologia_clinica">Psicología Clínica</option>
                <option value="psicoanalisis">Psicoanálisis</option>
                <option value="neuropsicologia">Neuropsicología</option>
                <option value="terapia_ocupacional">Terapia Ocupacional</option>
            </select>        
        </div>
    </div>
    <div class="cont">
        <input id="password" type="password" placeholder="Contraseña">
        <input id="confirmar"type="password" placeholder="Confirmar Contraseña">
        <button id="registrarBtn" class="btn">Registrarse</button><br>
    </div>
    </div>
    <a href="index.html">
    <div class="reg">
    <h3>Regresar</h3>
</div>
</a>
</div>

    <script>
        function toggleForm() {
            var form = document.getElementById("formPersonal");
            if (form.style.display === "none" || form.style.display === "") {
                form.style.display = "block";
                setTimeout(() => {
                    form.style.opacity = "1";
                    form.style.maxHeight = "500px";
                }, 10);
            } else {
                form.style.opacity = "0";
                form.style.maxHeight = "0";
                setTimeout(() => {
                    form.style.display = "none";
                }, 500);
            }
        }
    </script>
    <script src="js/doc.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    sendEmailVerification
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    setDoc
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAofOyGzsSWHQG3FfsFrGbVWjW0xMywb9c",
    authDomain: "doctrack-46fc2.firebaseapp.com",
    projectId: "doctrack-46fc2",
    storageBucket: "doctrack-46fc2.firebasestorage.app",
    messagingSenderId: "865552814891",
    appId: "1:865552814891:web:cf8e79d5ffd847067bab6e",
    measurementId: "G-XQPNKXK08Y"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  document.getElementById("registrarBtn")?.addEventListener("click", async () => {
    const nombre = document.getElementById("nombre").value.trim();
    const paterno = document.getElementById("paterno").value.trim();
    const materno = document.getElementById("materno").value.trim();
    const cedula = document.getElementById("cedula").value.trim();
    const correo = document.getElementById("correo").value.trim();
    const especialidad = document.getElementById("especialidad").value;
    const password = document.getElementById("password").value;
    const confirmar = document.getElementById("confirmar").value;

    // Validación de campos
    if (!nombre || !paterno || !materno || !cedula || !correo || especialidad === "ninguna" || !password || !confirmar) {
      return alert("Todos los campos son obligatorios.");
    }

    // Validación de coincidencia de contraseñas
    if (password !== confirmar) {
      return alert("Las contraseñas no coinciden.");
    }

    // Validación de seguridad de la contraseña
    if (password.length < 8 || !/\d/.test(password) || !/[a-zA-Z]/.test(password)) {
      return alert("La contraseña debe tener al menos 8 caracteres y contener letras y números.");
    }

    try {
      // Crear usuario en Firebase Auth
      const cred = await createUserWithEmailAndPassword(auth, correo, password);

      // Guardar los datos del doctor (sin contraseña)
      await setDoc(doc(db, "doctores", cred.user.uid), {
        nombre,
        ap_paterno: paterno,
        ap_materno: materno,
        cedula,
        correo,
        especialidad,
        rol: "doctor"
      });

      // Enviar verificación de correo
      await sendEmailVerification(cred.user);
      alert("Registro exitoso. Revisa tu correo para verificar tu cuenta.");

      // Redirigir al login
      window.location.href = "index.html";

    } catch (error) {
      if (error.code === "auth/email-already-in-use") {
        alert("El correo ya está registrado.");
      } else if (error.code === "auth/weak-password") {
        alert("La contraseña es demasiado débil.");
      } else {
        alert("Error al registrar: " + error.message);
      }
    }
  });
</script>



</body>
</html>